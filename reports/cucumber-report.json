[
  {
    "description": "  As a developer\n  I want the webhook handler migrated from Vercel to AWS Lambda\n  So that the function can be invoked directly by SNS without HTTP round-trips",
    "elements": [
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-processes-sns-event-with-customer.created-payload",
        "keyword": "Scenario",
        "line": 10,
        "name": "Lambda handler processes SNS event with customer.created payload",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 163416
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 21957
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 18040
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 2441542
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 802083
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 11,
            "name": "an SNS event containing a Commercetools customer.created webhook payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:100"
            },
            "result": {
              "status": "passed",
              "duration": 1299250
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 12,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 549421416
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 13,
            "name": "the handler should extract the Commercetools payload from the SNS Message field",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:341"
            },
            "result": {
              "status": "passed",
              "duration": 1153290
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 14,
            "name": "the handler should process the customer.created event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:349"
            },
            "result": {
              "status": "passed",
              "duration": 519583
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 15,
            "name": "the handler should return a successful response",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:335"
            },
            "result": {
              "status": "passed",
              "duration": 673250
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-processes-sns-event-with-customer.updated-payload",
        "keyword": "Scenario",
        "line": 17,
        "name": "Lambda handler processes SNS event with customer.updated payload",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 42332
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 23166
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 13583
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 41875
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 103874
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 18,
            "name": "an SNS event containing a Commercetools customer.updated webhook payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:110"
            },
            "result": {
              "status": "passed",
              "duration": 1126750
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 19,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 170646208
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 20,
            "name": "the handler should extract the Commercetools payload from the SNS Message field",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:341"
            },
            "result": {
              "status": "passed",
              "duration": 260916
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 21,
            "name": "the handler should process the customer.updated event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:356"
            },
            "result": {
              "status": "passed",
              "duration": 1203541
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 22,
            "name": "the handler should return a successful response",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:335"
            },
            "result": {
              "status": "passed",
              "duration": 71875
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-processes-sns-subscription-confirmation-request",
        "keyword": "Scenario",
        "line": 24,
        "name": "Lambda handler processes SNS subscription confirmation request",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 40000
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 14542
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 15834
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 49457
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 127958
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 25,
            "name": "an SNS subscription confirmation event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:120"
            },
            "result": {
              "status": "passed",
              "duration": 1203709
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 26,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 1261999
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 27,
            "name": "the handler should identify the event as a subscription confirmation",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:363"
            },
            "result": {
              "status": "passed",
              "duration": 766208
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 28,
            "name": "the handler should handle the subscription confirmation request",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:373"
            },
            "result": {
              "status": "passed",
              "duration": 515375
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 29,
            "name": "the handler should return a successful response",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:335"
            },
            "result": {
              "status": "passed",
              "duration": 52374
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-extracts-commercetools-payload-from-sns-message-field",
        "keyword": "Scenario",
        "line": 31,
        "name": "Lambda handler extracts Commercetools payload from SNS Message field",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 29584
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 18291
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 7624
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 19958
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 50458
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 32,
            "name": "an SNS event with a Message field containing a valid Commercetools webhook payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:125"
            },
            "result": {
              "status": "passed",
              "duration": 721499
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 33,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 169443125
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 34,
            "name": "the handler should parse the JSON from the SNS Message field",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:383"
            },
            "result": {
              "status": "passed",
              "duration": 816749
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 35,
            "name": "the handler should extract the Commercetools payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:390"
            },
            "result": {
              "status": "passed",
              "duration": 459499
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 36,
            "name": "the extracted payload should be compatible with existing business logic",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:397"
            },
            "result": {
              "status": "passed",
              "duration": 533124
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-converts-sns-event-format-to-existing-request-format",
        "keyword": "Scenario",
        "line": 38,
        "name": "Lambda handler converts SNS event format to existing request format",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 21584
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 9374
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 6459
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 18082
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 48624
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 39,
            "name": "an SNS event with a Commercetools customer.created payload in the Message field",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:135"
            },
            "result": {
              "status": "passed",
              "duration": 619583
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 40,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 179085291
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 41,
            "name": "the handler should convert the SNS event to a format compatible with existing validator",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:407"
            },
            "result": {
              "status": "passed",
              "duration": 1131499
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 42,
            "name": "the handler should convert the SNS event to a format compatible with existing transformer",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:417"
            },
            "result": {
              "status": "passed",
              "duration": 1023666
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 43,
            "name": "the handler should convert the SNS event to a format compatible with existing integration service",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:427"
            },
            "result": {
              "status": "passed",
              "duration": 912375
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-processes-customer-data-through-existing-business-logic-unchanged",
        "keyword": "Scenario",
        "line": 45,
        "name": "Lambda handler processes customer data through existing business logic unchanged",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 57750
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 9416
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 7916
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 43000
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 67667
            }
          },
          {
            "arguments": [
              {
                "rows": [
                  {
                    "cells": [
                      "field",
                      "value"
                    ]
                  },
                  {
                    "cells": [
                      "email",
                      "lambda@example.com"
                    ]
                  },
                  {
                    "cells": [
                      "firstName",
                      "Lambda"
                    ]
                  },
                  {
                    "cells": [
                      "lastName",
                      "Handler"
                    ]
                  }
                ]
              }
            ],
            "keyword": "Given ",
            "line": 46,
            "name": "an SNS event containing a Commercetools customer.created webhook payload with:",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:144"
            },
            "result": {
              "status": "passed",
              "duration": 1143333
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 51,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 172053584
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 52,
            "name": "the handler should validate the payload using the existing validator",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:437"
            },
            "result": {
              "status": "passed",
              "duration": 1269291
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 53,
            "name": "the handler should transform the customer data using the existing transformer",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:447"
            },
            "result": {
              "status": "passed",
              "duration": 794167
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 54,
            "name": "the handler should send the data to Segment using the existing integration service",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:457"
            },
            "result": {
              "status": "passed",
              "duration": 750292
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 55,
            "name": "the customer should be created in Segment with userId \"lambda@example.com\"",
            "result": {
              "status": "ambiguous",
              "duration": 0
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-handles-sns-event-with-notification-message-type",
        "keyword": "Scenario",
        "line": 57,
        "name": "Lambda handler handles SNS event with Notification message type",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 41624
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 20499
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 8291
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 39207
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 144875
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 58,
            "name": "an SNS event with Type \"Notification\" containing a Commercetools payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:202"
            },
            "result": {
              "status": "passed",
              "duration": 3060791
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 59,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 172448707
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 60,
            "name": "the handler should identify the message type as Notification",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:493"
            },
            "result": {
              "status": "passed",
              "duration": 1348333
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 61,
            "name": "the handler should extract and process the Commercetools payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:510"
            },
            "result": {
              "status": "passed",
              "duration": 1109083
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 62,
            "name": "the handler should return a successful response",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:335"
            },
            "result": {
              "status": "passed",
              "duration": 57875
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-handles-sns-event-with-subscriptionconfirmation-message-type",
        "keyword": "Scenario",
        "line": 64,
        "name": "Lambda handler handles SNS event with SubscriptionConfirmation message type",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 72208
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 23040
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 10084
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 68749
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 93166
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 65,
            "name": "an SNS event with Type \"SubscriptionConfirmation\"",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:218"
            },
            "result": {
              "status": "passed",
              "duration": 2223749
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 66,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 1505625
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 67,
            "name": "the handler should identify the message type as SubscriptionConfirmation",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:500"
            },
            "result": {
              "status": "passed",
              "duration": 1015791
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 68,
            "name": "the handler should handle the subscription confirmation",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:517"
            },
            "result": {
              "status": "passed",
              "duration": 515207
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 69,
            "name": "the handler should return a successful response",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:335"
            },
            "result": {
              "status": "passed",
              "duration": 33124
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-processes-sns-event-with-multiple-records",
        "keyword": "Scenario",
        "line": 71,
        "name": "Lambda handler processes SNS event with multiple records",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 21083
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 5457
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 4500
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 65958
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 42167
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 72,
            "name": "an SNS event with multiple Records containing Commercetools payloads",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:225"
            },
            "result": {
              "status": "passed",
              "duration": 699165
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 73,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 501138834
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 74,
            "name": "the handler should process each record in the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:524"
            },
            "result": {
              "status": "passed",
              "duration": 1487624
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 75,
            "name": "the handler should extract each Commercetools payload from the Message field",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:531"
            },
            "result": {
              "status": "passed",
              "duration": 1278332
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 76,
            "name": "the handler should return a successful response",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:335"
            },
            "result": {
              "status": "passed",
              "duration": 63583
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-maintains-compatibility-with-existing-webhook-processing-logic",
        "keyword": "Scenario",
        "line": 78,
        "name": "Lambda handler maintains compatibility with existing webhook processing logic",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 63208
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 15249
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 11040
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 45791
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 80290
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 79,
            "name": "an SNS event containing the same Commercetools payload that would be sent via HTTP webhook",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:235"
            },
            "result": {
              "status": "passed",
              "duration": 1474000
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 80,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 172777790
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 81,
            "name": "the handler should produce the same validation result as the HTTP webhook handler",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:541"
            },
            "result": {
              "status": "passed",
              "duration": 1678249
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 82,
            "name": "the handler should produce the same transformation result as the HTTP webhook handler",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:551"
            },
            "result": {
              "status": "passed",
              "duration": 955499
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 83,
            "name": "the handler should produce the same Segment integration result as the HTTP webhook handler",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:561"
            },
            "result": {
              "status": "passed",
              "duration": 676084
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-processes-customer.updated-event-through-complete-flow",
        "keyword": "Scenario",
        "line": 85,
        "name": "Lambda handler processes customer.updated event through complete flow",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 100709
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 27083
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 14292
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 31084
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 60125
            }
          },
          {
            "arguments": [
              {
                "rows": [
                  {
                    "cells": [
                      "field",
                      "value"
                    ]
                  },
                  {
                    "cells": [
                      "email",
                      "update@example.com"
                    ]
                  },
                  {
                    "cells": [
                      "firstName",
                      "Updated"
                    ]
                  },
                  {
                    "cells": [
                      "lastName",
                      "Customer"
                    ]
                  }
                ]
              }
            ],
            "keyword": "Given ",
            "line": 86,
            "name": "an SNS event containing a Commercetools customer.updated webhook payload with:",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:173"
            },
            "result": {
              "status": "passed",
              "duration": 1489416
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 91,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 172373000
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 92,
            "name": "the handler should extract the Commercetools payload from the SNS Message field",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:341"
            },
            "result": {
              "status": "passed",
              "duration": 301083
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 93,
            "name": "the handler should validate the payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:571"
            },
            "result": {
              "status": "passed",
              "duration": 921416
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 94,
            "name": "the handler should transform the customer data",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:578"
            },
            "result": {
              "status": "passed",
              "duration": 699583
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 95,
            "name": "the handler should send the data to Segment",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:585"
            },
            "result": {
              "status": "passed",
              "duration": 924625
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 96,
            "name": "the customer should be updated in Segment with userId \"update@example.com\"",
            "result": {
              "status": "ambiguous",
              "duration": 0
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-processes-different-sns-event-structures",
        "keyword": "Scenario Outline",
        "line": 106,
        "name": "Lambda handler processes different SNS event structures",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 41999
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 9459
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 7000
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 34709
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 138249
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 99,
            "name": "an SNS event with a single Record with Sns.Message field containing a Commercetools customer.created payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:267"
            },
            "result": {
              "status": "passed",
              "duration": 1069750
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 100,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 172018875
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 101,
            "name": "the handler should extract the Commercetools payload from the SNS Message field",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:341"
            },
            "result": {
              "status": "passed",
              "duration": 136999
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 102,
            "name": "the handler should process the event successfully",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:592"
            },
            "result": {
              "status": "passed",
              "duration": 848708
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-processes-different-sns-event-structures",
        "keyword": "Scenario Outline",
        "line": 107,
        "name": "Lambda handler processes different SNS event structures",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 25624
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 8084
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 19749
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 45374
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 146874
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 99,
            "name": "an SNS event with a Record with nested Sns.Message JSON string containing a Commercetools customer.created payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:276"
            },
            "result": {
              "status": "passed",
              "duration": 1138291
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 100,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 169291042
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 101,
            "name": "the handler should extract the Commercetools payload from the SNS Message field",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:341"
            },
            "result": {
              "status": "passed",
              "duration": 176084
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 102,
            "name": "the handler should process the event successfully",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:592"
            },
            "result": {
              "status": "passed",
              "duration": 96667
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      },
      {
        "description": "",
        "id": "lambda-handler-migration-for-sns-events;lambda-handler-processes-different-sns-event-structures",
        "keyword": "Scenario Outline",
        "line": 108,
        "name": "Lambda handler processes different SNS event structures",
        "steps": [
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 76665
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 12333
            }
          },
          {
            "keyword": "Before",
            "hidden": true,
            "result": {
              "status": "passed",
              "duration": 31167
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 7,
            "name": "the Lambda handler is deployed and available",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:85"
            },
            "result": {
              "status": "passed",
              "duration": 66167
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 8,
            "name": "the Lambda handler is configured with valid Segment credentials",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:90"
            },
            "result": {
              "status": "passed",
              "duration": 261082
            }
          },
          {
            "arguments": [],
            "keyword": "Given ",
            "line": 99,
            "name": "an SNS event with a Record with Sns.Type \"Notification\" containing a Commercetools customer.created payload",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:288"
            },
            "result": {
              "status": "passed",
              "duration": 2063166
            }
          },
          {
            "arguments": [],
            "keyword": "When ",
            "line": 100,
            "name": "the Lambda handler processes the SNS event",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:301"
            },
            "result": {
              "status": "passed",
              "duration": 169938292
            }
          },
          {
            "arguments": [],
            "keyword": "Then ",
            "line": 101,
            "name": "the handler should extract the Commercetools payload from the SNS Message field",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:341"
            },
            "result": {
              "status": "passed",
              "duration": 152667
            }
          },
          {
            "arguments": [],
            "keyword": "And ",
            "line": 102,
            "name": "the handler should process the event successfully",
            "match": {
              "location": "tests/steps/story-18-lambda-handler-migration.steps.ts:592"
            },
            "result": {
              "status": "passed",
              "duration": 142832
            }
          }
        ],
        "tags": [],
        "type": "scenario"
      }
    ],
    "id": "lambda-handler-migration-for-sns-events",
    "line": 1,
    "keyword": "Feature",
    "name": "Lambda Handler Migration for SNS Events",
    "tags": [],
    "uri": "features/story-18-lambda-handler-migration.feature"
  }
]